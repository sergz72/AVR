#include "board.h"
#include <segment_lcd.h>

#define MAX_CHARS_IN_LINE 6
#define CHAR_COUNT 13

#define L SEGMENT_LCD_DATA_WIDTH  * SEGMENT_LCD_COM_COUNT * MAX_CHARS_IN_LINE

static const char lcd_char_table[CHAR_COUNT][L] = 
{
    // 0
    {
        // position 1
        0x00,0x80,0x01, // com0
        0x00,0x00,0x01, // com1
        0x00,0x80,0x01, // com2
        0x00,0x00,0x01, // com3
        // position 2
        0x00,0x60,0x00, // com0
        0x00,0x40,0x00, // com1
        0x00,0x60,0x00, // com2
        0x00,0x40,0x00, // com3
        // position 3
        0x00,0x18,0x00, // com0
        0x00,0x10,0x00, // com1
        0x00,0x18,0x00, // com2
        0x00,0x10,0x00, // com3
        // position 4
        0x00,0x06,0x00, // com0
        0x00,0x04,0x00, // com1
        0x00,0x06,0x00, // com2
        0x00,0x04,0x00, // com3
        // position 5
        0x60,0x00,0x00, // com0
        0x20,0x00,0x00, // com1
        0x60,0x00,0x00, // com2
        0x20,0x00,0x00, // com3
        // position 6
        0x80,0x01,0x00, // com0
        0x80,0x00,0x00, // com1
        0x80,0x01,0x00, // com2
        0x80,0x00,0x00  // com3
    },
    // 1
    {
        // position 1
        0x00,0x80,0x00, // com0
        0x00,0x00,0x00, // com1
        0x00,0x80,0x00, // com2
        0x00,0x00,0x00, // com3
        // position 2
        0x00,0x20,0x00, // com0
        0x00,0x00,0x00, // com1
        0x00,0x20,0x00, // com2
        0x00,0x00,0x00, // com3
        // position 3
        0x00,0x08,0x00, // com0
        0x00,0x00,0x00, // com1
        0x00,0x08,0x00, // com2
        0x00,0x00,0x00, // com3
        // position 4
        0x00,0x02,0x00, // com0
        0x00,0x00,0x00, // com1
        0x00,0x02,0x00, // com2
        0x00,0x00,0x00, // com3
        // position 5
        0x40,0x00,0x00, // com0
        0x00,0x00,0x00, // com1
        0x40,0x00,0x00, // com2
        0x00,0x00,0x00, // com3
        // position 6
        0x00,0x01,0x00, // com0
        0x00,0x00,0x00, // com1
        0x00,0x01,0x00, // com2
        0x00,0x00,0x00  // com3
    },
    // 2
    {
        // position 1
        0x00,0x80,0x01, // com0
        0x00,0x80,0x00, // com1
        0x00,0x00,0x01, // com2
        0x00,0x00,0x01, // com3
        // position 2
        0x00,0x60,0x00, // com0
        0x00,0x20,0x00, // com1
        0x00,0x40,0x00, // com2
        0x00,0x40,0x00, // com3
        // position 3
        0x00,0x18,0x00, // com0
        0x00,0x08,0x00, // com1
        0x00,0x10,0x00, // com2
        0x00,0x10,0x00, // com3
        // position 4
        0x00,0x06,0x00, // com0
        0x00,0x02,0x00, // com1
        0x00,0x04,0x00, // com2
        0x00,0x04,0x00, // com3
        // position 5
        0x60,0x00,0x00, // com0
        0x40,0x00,0x00, // com1
        0x20,0x00,0x00, // com2
        0x20,0x00,0x00, // com3
        // position 6
        0x80,0x01,0x00, // com0
        0x00,0x01,0x00, // com1
        0x80,0x00,0x00, // com2
        0x80,0x00,0x00  // com3
    },
    // 3
    {
        // position 1
        0x00,0x80,0x01, // com0
        0x00,0x80,0x00, // com1
        0x00,0x80,0x00, // com2
        0x00,0x00,0x01, // com3
        // position 2
        0x00,0x60,0x00, // com0
        0x00,0x20,0x00, // com1
        0x00,0x20,0x00, // com2
        0x00,0x40,0x00, // com3
        // position 3
        0x00,0x18,0x00, // com0
        0x00,0x08,0x00, // com1
        0x00,0x08,0x00, // com2
        0x00,0x10,0x00, // com3
        // position 4
        0x00,0x06,0x00, // com0
        0x00,0x02,0x00, // com1
        0x00,0x02,0x00, // com2
        0x00,0x04,0x00, // com3
        // position 5
        0x60,0x00,0x00, // com0
        0x40,0x00,0x00, // com1
        0x40,0x00,0x00, // com2
        0x20,0x00,0x00, // com3
        // position 6
        0x80,0x01,0x00, // com0
        0x00,0x01,0x00, // com1
        0x00,0x01,0x00, // com2
        0x80,0x00,0x00  // com3
    },
    // 4
    {
        // position 1
        0x00,0x80,0x00, // com0
        0x00,0x80,0x01, // com1
        0x00,0x80,0x00, // com2
        0x00,0x00,0x00, // com3
        // position 2
        0x00,0x20,0x00, // com0
        0x00,0x60,0x00, // com1
        0x00,0x20,0x00, // com2
        0x00,0x00,0x00, // com3
        // position 3
        0x00,0x08,0x00, // com0
        0x00,0x18,0x00, // com1
        0x00,0x08,0x00, // com2
        0x00,0x00,0x00, // com3
        // position 4
        0x00,0x02,0x00, // com0
        0x00,0x06,0x00, // com1
        0x00,0x02,0x00, // com2
        0x00,0x00,0x00, // com3
        // position 5
        0x40,0x00,0x00, // com0
        0x60,0x00,0x00, // com1
        0x40,0x00,0x00, // com2
        0x00,0x00,0x00, // com3
        // position 6
        0x00,0x01,0x00, // com0
        0x80,0x01,0x00, // com1
        0x00,0x01,0x00, // com2
        0x00,0x00,0x00  // com3
    },
    // 5
    {
        // position 1
        0x00,0x00,0x01, // com0
        0x00,0x80,0x01, // com1
        0x00,0x80,0x00, // com2
        0x00,0x00,0x01, // com3
        // position 2
        0x00,0x40,0x00, // com0
        0x00,0x60,0x00, // com1
        0x00,0x20,0x00, // com2
        0x00,0x40,0x00, // com3
        // position 3
        0x00,0x10,0x00, // com0
        0x00,0x18,0x00, // com1
        0x00,0x08,0x00, // com2
        0x00,0x10,0x00, // com3
        // position 4
        0x00,0x04,0x00, // com0
        0x00,0x06,0x00, // com1
        0x00,0x02,0x00, // com2
        0x00,0x04,0x00, // com3
        // position 5
        0x20,0x00,0x00, // com0
        0x60,0x00,0x00, // com1
        0x40,0x00,0x00, // com2
        0x20,0x00,0x00, // com3
        // position 6
        0x80,0x00,0x00, // com0
        0x80,0x01,0x00, // com1
        0x00,0x01,0x00, // com2
        0x80,0x00,0x00  // com3
    },
    // 6
    {
        // position 1
        0x00,0x00,0x01, // com0
        0x00,0x80,0x01, // com1
        0x00,0x80,0x01, // com2
        0x00,0x00,0x01, // com3
        // position 2
        0x00,0x40,0x00, // com0
        0x00,0x60,0x00, // com1
        0x00,0x60,0x00, // com2
        0x00,0x40,0x00, // com3
        // position 3
        0x00,0x10,0x00, // com0
        0x00,0x18,0x00, // com1
        0x00,0x18,0x00, // com2
        0x00,0x10,0x00, // com3
        // position 4
        0x00,0x04,0x00, // com0
        0x00,0x06,0x00, // com1
        0x00,0x06,0x00, // com2
        0x00,0x04,0x00, // com3
        // position 5
        0x20,0x00,0x00, // com0
        0x60,0x00,0x00, // com1
        0x60,0x00,0x00, // com2
        0x20,0x00,0x00, // com3
        // position 6
        0x80,0x00,0x00, // com0
        0x80,0x01,0x00, // com1
        0x80,0x01,0x00, // com2
        0x80,0x00,0x00  // com3
    },
    // 7
    {
        // position 1
        0x00,0x80,0x01, // com0
        0x00,0x00,0x00, // com1
        0x00,0x80,0x00, // com2
        0x00,0x00,0x00, // com3
        // position 2
        0x00,0x60,0x00, // com0
        0x00,0x00,0x00, // com1
        0x00,0x20,0x00, // com2
        0x00,0x00,0x00, // com3
        // position 3
        0x00,0x18,0x00, // com0
        0x00,0x00,0x00, // com1
        0x00,0x08,0x00, // com2
        0x00,0x00,0x00, // com3
        // position 4
        0x00,0x06,0x00, // com0
        0x00,0x00,0x00, // com1
        0x00,0x02,0x00, // com2
        0x00,0x00,0x00, // com3
        // position 5
        0x60,0x00,0x00, // com0
        0x00,0x00,0x00, // com1
        0x40,0x00,0x00, // com2
        0x00,0x00,0x00, // com3
        // position 6
        0x80,0x01,0x00, // com0
        0x00,0x00,0x00, // com1
        0x00,0x01,0x00, // com2
        0x00,0x00,0x00  // com3
    },
    // 8
    {
        // position 1
        0x00,0x80,0x01, // com0
        0x00,0x80,0x01, // com1
        0x00,0x80,0x01, // com2
        0x00,0x00,0x01, // com3
        // position 2
        0x00,0x60,0x00, // com0
        0x00,0x60,0x00, // com1
        0x00,0x60,0x00, // com2
        0x00,0x40,0x00, // com3
        // position 3
        0x00,0x18,0x00, // com0
        0x00,0x18,0x00, // com1
        0x00,0x18,0x00, // com2
        0x00,0x10,0x00, // com3
        // position 4
        0x00,0x06,0x00, // com0
        0x00,0x06,0x00, // com1
        0x00,0x06,0x00, // com2
        0x00,0x04,0x00, // com3
        // position 5
        0x60,0x00,0x00, // com0
        0x60,0x00,0x00, // com1
        0x60,0x00,0x00, // com2
        0x20,0x00,0x00, // com3
        // position 6
        0x80,0x01,0x00, // com0
        0x80,0x01,0x00, // com1
        0x80,0x01,0x00, // com2
        0x80,0x00,0x00  // com3
    },
    // 9
    {
        // position 1
        0x00,0x80,0x01, // com0
        0x00,0x80,0x01, // com1
        0x00,0x80,0x00, // com2
        0x00,0x00,0x01, // com3
        // position 2
        0x00,0x60,0x00, // com0
        0x00,0x60,0x00, // com1
        0x00,0x20,0x00, // com2
        0x00,0x40,0x00, // com3
        // position 3
        0x00,0x18,0x00, // com0
        0x00,0x18,0x00, // com1
        0x00,0x08,0x00, // com2
        0x00,0x10,0x00, // com3
        // position 4
        0x00,0x06,0x00, // com0
        0x00,0x06,0x00, // com1
        0x00,0x02,0x00, // com2
        0x00,0x04,0x00, // com3
        // position 5
        0x60,0x00,0x00, // com0
        0x60,0x00,0x00, // com1
        0x40,0x00,0x00, // com2
        0x20,0x00,0x00, // com3
        // position 6
        0x80,0x01,0x00, // com0
        0x80,0x01,0x00, // com1
        0x00,0x01,0x00, // com2
        0x80,0x00,0x00  // com3
    },
    // U
    {
        // position 1
        0x00,0x80,0x00, // com0
        0x00,0x00,0x01, // com1
        0x00,0x80,0x01, // com2
        0x00,0x00,0x01, // com3
        // position 2
        0x00,0x20,0x00, // com0
        0x00,0x40,0x00, // com1
        0x00,0x60,0x00, // com2
        0x00,0x40,0x00, // com3
        // position 3
        0x00,0x08,0x00, // com0
        0x00,0x10,0x00, // com1
        0x00,0x18,0x00, // com2
        0x00,0x10,0x00, // com3
        // position 4
        0x00,0x02,0x00, // com0
        0x00,0x04,0x00, // com1
        0x00,0x06,0x00, // com2
        0x00,0x04,0x00, // com3
        // position 5
        0x40,0x00,0x00, // com0
        0x20,0x00,0x00, // com1
        0x60,0x00,0x00, // com2
        0x20,0x00,0x00, // com3
        // position 6
        0x00,0x01,0x00, // com0
        0x80,0x00,0x00, // com1
        0x80,0x01,0x00, // com2
        0x80,0x00,0x00  // com3
    },
    // o
    {
        // position 1
        0x00,0x00,0x00, // com0
        0x00,0x80,0x00, // com1
        0x00,0x80,0x01, // com2
        0x00,0x00,0x01, // com3
        // position 2
        0x00,0x00,0x00, // com0
        0x00,0x20,0x00, // com1
        0x00,0x60,0x00, // com2
        0x00,0x40,0x00, // com3
        // position 3
        0x00,0x00,0x00, // com0
        0x00,0x08,0x00, // com1
        0x00,0x18,0x00, // com2
        0x00,0x10,0x00, // com3
        // position 4
        0x00,0x00,0x00, // com0
        0x00,0x02,0x00, // com1
        0x00,0x06,0x00, // com2
        0x00,0x04,0x00, // com3
        // position 5
        0x00,0x00,0x00, // com0
        0x40,0x00,0x00, // com1
        0x60,0x00,0x00, // com2
        0x20,0x00,0x00, // com3
        // position 6
        0x00,0x00,0x00, // com0
        0x00,0x01,0x00, // com1
        0x80,0x01,0x00, // com2
        0x80,0x00,0x00  // com3
    },
    // K
    {
        // position 1
        0x00,0x80,0x00, // com0
        0x00,0x80,0x01, // com1
        0x00,0x80,0x01, // com2
        0x00,0x00,0x00, // com3
        // position 2
        0x00,0x20,0x00, // com0
        0x00,0x60,0x00, // com1
        0x00,0x60,0x00, // com2
        0x00,0x00,0x00, // com3
        // position 3
        0x00,0x08,0x00, // com0
        0x00,0x18,0x00, // com1
        0x00,0x18,0x00, // com2
        0x00,0x00,0x00, // com3
        // position 4
        0x00,0x02,0x00, // com0
        0x00,0x06,0x00, // com1
        0x00,0x06,0x00, // com2
        0x00,0x00,0x00, // com3
        // position 5
        0x40,0x00,0x00, // com0
        0x60,0x00,0x00, // com1
        0x60,0x00,0x00, // com2
        0x00,0x00,0x00, // com3
        // position 6
        0x00,0x01,0x00, // com0
        0x80,0x01,0x00, // com1
        0x80,0x01,0x00, // com2
        0x00,0x00,0x00  // com3
    }
};
    
void SegmentLcdBuildCharData(unsigned char c, unsigned char pos, unsigned char com, unsigned char *segment_lcd_data)
{
    unsigned char i, *p, point;
    
    point = c & 0x80;
    c &= 0x7F;
    
    if (c > 13)
        return;
    
    pos *= SEGMENT_LCD_COM_COUNT * SEGMENT_LCD_DATA_WIDTH;
    pos += com * SEGMENT_LCD_DATA_WIDTH;
    p = &lcd_char_table[c][pos];
    
    for (i = 0; i < SEGMENT_LCD_DATA_WIDTH; i++)
    {
        c = *segment_lcd_data;
        c |= *p++;
        if (point)
        {
            switch (pos)
            {
                case 9:
                    if (i == 1)
                        c |= 0x80; // PD7
                    break;
                case 21:
                    if (i == 1)
                        c |= 0x20; // PD5
                    break;
                case 33:
                    if (i == 1)
                        c |= 8; // PD3
                    break;
                case 45:
                    if (i == 1)
                        c |= 2; // PD1
                    break;
                case 57:
                    if (i == 0)
                        c |= 0x40; // PA6
                    break;
                case 69:
                    if (i == 1)
                        c |= 1; // PD0
                    break;
            }
        }
        *segment_lcd_data++ = c;
    }
}
